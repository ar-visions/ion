diff --git a/CMakeLists.txt b/CMakeLists.txt
index 02a879c..81d836d 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -22,13 +22,19 @@ INCLUDE(CMakeDependentOption)
 SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_CURRENT_SOURCE_DIR}/cmake")
 
 IF(NOT CMAKE_BUILD_TYPE)
-  SET(CMAKE_BUILD_TYPE Release)
+    SET(CMAKE_BUILD_TYPE Release)
 ENDIF()
 
 IF (UNIX)
 	ADD_COMPILE_OPTIONS(-lm)
 ENDIF()
 
+if (VKVG_BUILD_SHARED_LIB)
+    #message(FATAL_ERROR "outputting shared lib")
+else()
+    #message(FATAL_ERROR "outputting STATIC lib")
+endif()
+
 if (CMAKE_BUILD_TYPE STREQUAL "Debug")
 	ADD_DEFINITIONS (-DDEBUG)
 	OPTION(ENABLE_VALIDATION "enable vulkan validation layer" ON)
@@ -49,9 +55,9 @@ ELSE()
 	UNSET(VKVG_WIRED_FILL CACHE)
 	UNSET(VKVG_USE_MESA_OVERLAY CACHE)
 	IF (ANDROID)
-		ADD_COMPILE_OPTIONS(-O3 -w -ansi -pedantic)
+		ADD_COMPILE_OPTIONS(-O3 -w -pedantic)
 	ELSEIF (UNIX)		
-		ADD_COMPILE_OPTIONS(-O3 -w -ansi -pedantic -fvisibility=hidden -fno-rtti)
+		ADD_COMPILE_OPTIONS(-O3 -w -pedantic -fvisibility=hidden -fno-rtti)
 		#ADD_COMPILE_OPTIONS(-flto -pthread -lpthread -Wl,--no-as-needed)
 	ELSEIF(MSVC)
 		ADD_COMPILE_OPTIONS(/O2 /TC /W0 /Od)
@@ -121,19 +127,15 @@ IF (VKVG_WIRED_FILL)
 	ADD_DEFINITIONS (-DVKVG_WIRED_DEBUG)
 ENDIF ()
 
-
+# aarch64 is Apple arch and VulkanSDK does not run there.
+# reports unsupported arch in console when I create a device
+# MoltenVK is just a better idea for Mac anyway so this may just be a Mac switch
+# would seem odd to have different stacks based on the Intel/Apple chip
 FIND_PACKAGE(Vulkan REQUIRED)
-
 FIND_PACKAGE(Freetype QUIET)
 FIND_PACKAGE(Fontconfig QUIET)
 FIND_PACKAGE(HarfBuzz QUIET)
 FIND_PACKAGE(glfw3 CONFIG QUIET)
-if (glfw3_FOUND)
-    set(GLFW3_FOUND TRUE)
-    set(GLFW3_LIBRARY glfw)
-else()
-    FIND_PACKAGE(GLFW3 QUIET)
-endif()
 FIND_PACKAGE(Doxygen QUIET)
 
 CMAKE_DEPENDENT_OPTION(VKVG_USE_FREETYPE	"use freetype to load and render font glyphs" ON "Freetype_FOUND" OFF)
@@ -299,7 +301,7 @@ FUNCTION (setup_lib LibName)
 	IF(VKVG_USE_GLUTESS)
 		TARGET_LINK_LIBRARIES("${LibName}" PRIVATE glutess)
 	ENDIF()
-
+	
 	TARGET_LINK_LIBRARIES("${LibName}"
 		PUBLIC
 			${Vulkan_LIBRARIES}
@@ -312,6 +314,7 @@ FUNCTION (setup_lib LibName)
 ENDFUNCTION(setup_lib)
 
 GET_DIRECTORY_PROPERTY (vkvg_has_root_project PARENT_DIRECTORY)
+set(vkvg_has_root_project TRUE)
 
 # TARGET_INCLUDE_DIRECTORIES("${PROJECT_NAME}_obj"
 # 	PRIVATE
diff --git a/src/shaders.h b/src/shaders.h
index b4a8c8e..efab49a 100644
--- a/src/shaders.h
+++ b/src/shaders.h
@@ -1,5 +1,5 @@
 unsigned char shader_comp_spv[] = {
-  0x03, 0x02, 0x23, 0x07, 0x00, 0x00, 0x01, 0x00, 0x0a, 0x00, 0x0d, 0x00,
+  0x03, 0x02, 0x23, 0x07, 0x00, 0x00, 0x01, 0x00, 0x0b, 0x00, 0x0d, 0x00,
   0xa1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x02, 0x00,
   0x01, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x06, 0x00, 0x01, 0x00, 0x00, 0x00,
   0x47, 0x4c, 0x53, 0x4c, 0x2e, 0x73, 0x74, 0x64, 0x2e, 0x34, 0x35, 0x30,
@@ -301,7 +301,7 @@ unsigned char shader_comp_spv[] = {
 };
 unsigned int shader_comp_spv_len = 3580;
 unsigned char shader2_comp_spv[] = {
-  0x03, 0x02, 0x23, 0x07, 0x00, 0x00, 0x01, 0x00, 0x0a, 0x00, 0x0d, 0x00,
+  0x03, 0x02, 0x23, 0x07, 0x00, 0x00, 0x01, 0x00, 0x0b, 0x00, 0x0d, 0x00,
   0x6c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x02, 0x00,
   0x01, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x06, 0x00, 0x01, 0x00, 0x00, 0x00,
   0x47, 0x4c, 0x53, 0x4c, 0x2e, 0x73, 0x74, 0x64, 0x2e, 0x34, 0x35, 0x30,
@@ -521,7 +521,7 @@ unsigned char shader2_comp_spv[] = {
 };
 unsigned int shader2_comp_spv_len = 2604;
 unsigned char vkvg_main_frag_spv[] = {
-  0x03, 0x02, 0x23, 0x07, 0x00, 0x00, 0x01, 0x00, 0x0a, 0x00, 0x0d, 0x00,
+  0x03, 0x02, 0x23, 0x07, 0x00, 0x00, 0x01, 0x00, 0x0b, 0x00, 0x0d, 0x00,
   0x97, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x02, 0x00,
   0x01, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x06, 0x00, 0x01, 0x00, 0x00, 0x00,
   0x47, 0x4c, 0x53, 0x4c, 0x2e, 0x73, 0x74, 0x64, 0x2e, 0x34, 0x35, 0x30,
@@ -1319,7 +1319,7 @@ unsigned char vkvg_main_frag_spv[] = {
 };
 unsigned int vkvg_main_frag_spv_len = 9532;
 unsigned char vkvg_main_vert_spv[] = {
-  0x03, 0x02, 0x23, 0x07, 0x00, 0x00, 0x01, 0x00, 0x0a, 0x00, 0x0d, 0x00,
+  0x03, 0x02, 0x23, 0x07, 0x00, 0x00, 0x01, 0x00, 0x0b, 0x00, 0x0d, 0x00,
   0x85, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x02, 0x00,
   0x01, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x06, 0x00, 0x01, 0x00, 0x00, 0x00,
   0x47, 0x4c, 0x53, 0x4c, 0x2e, 0x73, 0x74, 0x64, 0x2e, 0x34, 0x35, 0x30,
@@ -1631,7 +1631,7 @@ unsigned char vkvg_main_vert_spv[] = {
 };
 unsigned int vkvg_main_vert_spv_len = 3704;
 unsigned char vkvg_main_lcd_frag_spv[] = {
-  0x03, 0x02, 0x23, 0x07, 0x00, 0x00, 0x01, 0x00, 0x0a, 0x00, 0x0d, 0x00,
+  0x03, 0x02, 0x23, 0x07, 0x00, 0x00, 0x01, 0x00, 0x0b, 0x00, 0x0d, 0x00,
   0xef, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x02, 0x00,
   0x01, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x06, 0x00, 0x01, 0x00, 0x00, 0x00,
   0x47, 0x4c, 0x53, 0x4c, 0x2e, 0x73, 0x74, 0x64, 0x2e, 0x34, 0x35, 0x30,
@@ -2116,7 +2116,7 @@ unsigned char vkvg_main_lcd_frag_spv[] = {
 };
 unsigned int vkvg_main_lcd_frag_spv_len = 5784;
 unsigned char wired_frag_spv[] = {
-  0x03, 0x02, 0x23, 0x07, 0x00, 0x00, 0x01, 0x00, 0x0a, 0x00, 0x0d, 0x00,
+  0x03, 0x02, 0x23, 0x07, 0x00, 0x00, 0x01, 0x00, 0x0b, 0x00, 0x0d, 0x00,
   0x2c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x02, 0x00,
   0x01, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x06, 0x00, 0x01, 0x00, 0x00, 0x00,
   0x47, 0x4c, 0x53, 0x4c, 0x2e, 0x73, 0x74, 0x64, 0x2e, 0x34, 0x35, 0x30,
diff --git a/src/vkvg_device.c b/src/vkvg_device.c
index b3d0107..75f84ad 100644
--- a/src/vkvg_device.c
+++ b/src/vkvg_device.c
@@ -1,4 +1,4 @@
-﻿/*
+/*
  * Copyright (c) 2018-2022 Jean-Philippe Bruyère <jp_bruyere@hotmail.com>
  *
  * Permission is hereby granted, free of charge, to any person obtaining a copy of
@@ -87,7 +87,8 @@ void _device_init (VkvgDevice dev, VkInstance inst, VkPhysicalDevice phy, VkDevi
 #ifdef VKH_USE_VMA
 	VmaAllocatorCreateInfo allocatorInfo = {
 		.physicalDevice = phy,
-		.device = vkdev
+		.device = vkdev,
+        .instance = inst
 	};
 	vmaCreateAllocator(&allocatorInfo, (VmaAllocator*)&dev->allocator);
 #endif
diff --git a/vkh b/vkh
index 1d0c0f4..bede6ae 160000
--- a/vkh
+++ b/vkh
@@ -1 +1 @@
-Subproject commit 1d0c0f45a2389d2e8b93c8c562ef467196fc38fd
+Subproject commit bede6aeb4264040784a422e64796ce21a012eab5-dirty
